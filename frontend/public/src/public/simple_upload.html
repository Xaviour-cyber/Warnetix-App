<!doctype html>
<html>
<head>
  <meta charset="utf-8" />
  <title>Warnetix</title>
  <style>
    body { font-family: Arial, sans-serif; background:#111; color:#eee; display:flex; flex-direction:column; align-items:center; padding:40px;}
    #drop { width:600px; height:200px; border:3px dashed #8B0000; border-radius:12px; display:flex; align-items:center; justify-content:center; color:#fff; background:#222;}
    #drop.hover { background:#2a2a2a; }
    button { background:#8B0000; color:#fff; border:none; padding:10px 18px; border-radius:8px; cursor:pointer; }
    pre { max-width: 900px; white-space: pre-wrap; word-break:break-word; background:#000; padding:12px; border-radius:8px; margin-top:18px; color:#9cf;}
    .row { margin-top:12px; display:flex; gap:12px; align-items:center; }
    input[type="text"]{ width:520px; padding:8px; border-radius:8px; border:1px solid #333; background:#1a1a1a; color:#eee;}
  </style>
</head>
<body>
  <h1>Warnetix - Upload & Scan Demo</h1>

  <div class="row">
    <label>Backend API:</label>
    <input id="apiBase" type="text" placeholder="https://warnetix-backend.up.railway.app" />
    <button id="saveApi">Save</button>
  </div>

  <div id="drop" style="margin-top:14px;">Drag & Drop file here or <input id="fileinput" type="file" /></div>

  <div class="row">
    <label><input id="wait" type="checkbox" /> Wait for VirusTotal (blocking)</label>
    <button id="uploadBtn">Upload & Scan</button>
  </div>

  <pre id="out">Result will appear here...</pre>

  <script type="module">
    const drop = document.getElementById('drop');
    const fileInput = document.getElementById('fileinput');
    const uploadBtn = document.getElementById('uploadBtn');
    const out = document.getElementById('out');
    const waitCB = document.getElementById('wait');
    const apiBaseInput = document.getElementById('apiBase');
    const saveApiBtn = document.getElementById('saveApi');

    // default ke backend Railway (fallback ke localhost utk dev)
    const DEFAULT_API = 'https://warnetix-backend.up.railway.app';
    const API = localStorage.getItem('API') || DEFAULT_API;
    apiBaseInput.value = API;

    saveApiBtn.addEventListener('click', () => {
      const v = apiBaseInput.value.trim();
      if (!v) return;
      localStorage.setItem('API', v);
      out.textContent = `Saved API base → ${v}`;
    });

    let currentFile = null;

    drop.addEventListener('dragover', e => { e.preventDefault(); drop.classList.add('hover'); });
    drop.addEventListener('dragleave', () => drop.classList.remove('hover'));
    drop.addEventListener('drop', e => {
      e.preventDefault(); drop.classList.remove('hover');
      const f = e.dataTransfer.files?.[0];
      if (f) { currentFile = f; out.textContent = `Selected: ${f.name} (${f.size} bytes)`; }
    });

    fileInput.addEventListener('change', e => {
      const f = e.target.files?.[0];
      if (f) { currentFile = f; out.textContent = `Selected: ${f.name} (${f.size} bytes)`; }
    });

    uploadBtn.addEventListener('click', async () => {
      if (!currentFile) { alert("Pilih file dulu (drag/drop)"); return; }
      out.textContent = "Uploading & scanning...";

      const fd = new FormData();
      fd.append('file', currentFile, currentFile.name);

      const qs = waitCB.checked ? '?wait=true' : '';
      // sesuai arsitektur backend → prefix /api
      const url = `${apiBaseInput.value || DEFAULT_API}/api/scan-file${qs}`;

      try {
        const resp = await fetch(url, { method: 'POST', body: fd });
        const data = await resp.json();
        out.textContent = JSON.stringify(data, null, 2);
      } catch (err) {
        out.textContent = "ERROR: " + err;
      }
    });
  </script>
</body>
</html>
